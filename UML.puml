@startuml
' UML diagram for s-Java verifier architecture
skinparam packageStyle rectangle
skinparam shadowing false
skinparam classAttributeIconSize 0

package "ex5.main" {
  class Sjavac {
    +main(String[] args)
  }
  abstract class SJavaException {
    -message : String
    -lineNumber : int
    +getFormattedMessage() : String
  }
  class InvalidFileException extends SJavaException
  class SyntaxException extends SJavaException
}

package "ex5.preprocessor" {
  class CodePreprocessor {
    +{static} preprocess(String) : List<ProcessedLine>
  }
  class PreprocessorException extends SyntaxException
}

package "ex5.parser" {
  class CodeParser {
    +{static} parse(String) : GlobalScope
  }
  class ParserException extends SyntaxException
}

package "ex5.models" {
  class ProcessedLine {
    -originalLineNumber : int
    -content : String
  }
  class Variable {
    -name : String
    -type : String
    -isFinal : boolean
    -isInitialized : boolean
    -isParameter : boolean
    -lineNumber : int
    +initialize() : void
    +canAssign() : boolean
  }
  class VariableTable {
    -variables : HashMap<String, Variable>
    +addVariable(Variable) : void
    +getVariable(String) : Variable
    +containsVariable(String) : boolean
    +isInitialized(String) : boolean
    +getAllVariables() : Collection<Variable>
  }
  class Method {
    -name : String
    -parameters : List<Variable>
    -scope : MethodScope
    -declarationLine : int
    +addParameter(Variable) : void
    +getParameterCount() : int
    +getParameterTypes() : List<String>
    +matchesSignature(String, List<String>) : boolean
  }
  enum Statement {
    VAR_DECLARATION
    ASSIGNMENT
    METHOD_CALL
    IF_BLOCK
    WHILE_BLOCK
    RETURN
    --
    -type : StatementType
    -lineNumber : int
    -content : String
  }
}

package "ex5.scope" {
  abstract class Scope {
    -variables : VariableTable
    -parentScope : Scope
    -childScopes : List<Scope>
    -statements : List<Statement>
    -startLine : int
    -endLine : int
    -{static} globalMethods : Map<String, Method>
    +addVariable(Variable) : void
    +findVariable(String) : Variable
    +addStatement(Statement) : void
    +addChildScope(Scope) : void
    +getDepth() : int
    +{static} registerMethod(Method) : void
    +{static} getMethod(String) : Method
    +{static} methodExists(String) : boolean
    +{abstract} validate() : void
    #validateStatements(List<ProcessedLine>, int, int) : void
  }
  class GlobalScope extends Scope {
    +validate(List<ProcessedLine>) : void
  }
  class MethodScope extends Scope {
    -methodDefinition : Method
    -lastStatementLine : int
    +addParameter(Variable) : void
    +validate(List<ProcessedLine>, int, int) : void
  }
  class BlockScope extends Scope {
    -blockType : String
    -condition : String
    -blockEndLine : int
    +validate(List<ProcessedLine>, int, int) : void
  }
  class ScopeException extends SyntaxException
}

package "ex5.validator" {
  class RegexManager {
    -{static} TYPE_COMPATIBILITY : Map<String, Set<String>>
    +{static} isTypeCompatible(String, String) : boolean
    +{static} matchesPattern(String, Pattern) : boolean
    +{static} getMatcher(String, Pattern) : Matcher
    +{static} extractGroups(String, Pattern) : String[]
    +{static} isValidValueForType(String, String, Scope) : boolean
  }
  class VariableValidator {
    +{static} validateVariableName(String) : void
    +{static} validateTypeCompatibility(String, String) : void
    +{static} validateValue(String, String, Scope) : void
    +{static} validateVariableUsage(Scope, String, int) : void
    +{static} validateFinalVariable(Variable) : void
    +{static} validateScopeAccess(Scope, String) : void
  }
  class MethodValidator {
    +{static} validateMethodSignature(String, List<Variable>) : void
    +{static} validateMethodCall(String, List<String>, Scope) : void
    +{static} validateLastStatementIsReturn(int, List<ProcessedLine>) : void
  }
  class ControlFlowValidator {
    +{static} validateCondition(String, Scope) : void
    +{static} validateConditionVariables(String, Scope) : void
    +{static} validateOperators(String) : void
  }
  class VariableException extends SyntaxException
  class MethodException extends SyntaxException
  class ConditionException extends SyntaxException
}

Sjavac --> CodeParser : parse()
CodeParser --> CodePreprocessor : preprocess()
CodeParser --> GlobalScope : validate()
GlobalScope --> MethodScope : owns
MethodScope --> BlockScope : owns
Scope *-- VariableTable
Scope o-- Scope : parent/child
Scope --> Method : uses registry
CodePreprocessor --> ProcessedLine : returns
MethodScope --> Method : methodDefinition
VariableTable --> Variable
Method --> Variable : parameters
MethodValidator ..> Scope
VariableValidator ..> Scope
ControlFlowValidator ..> Scope
Scope <|-- GlobalScope
Scope <|-- MethodScope
Scope <|-- BlockScope
SJavaException <|-- InvalidFileException
SJavaException <|-- SyntaxException
SyntaxException <|-- PreprocessorException
SyntaxException <|-- ParserException
SyntaxException <|-- ScopeException
SyntaxException <|-- VariableException
SyntaxException <|-- MethodException
SyntaxException <|-- ConditionException

note bottom
Data flow: Sjavac -> CodeParser -> CodePreprocessor -> GlobalScope.validate()
  -> MethodScope.validate() -> BlockScope.validate()
end note

@enduml

